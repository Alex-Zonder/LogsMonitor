<!-- ----------------------   Style   ---------------------- -->
<style media="screen">
.Bread {
	cursor:pointer;
	float:left;
}
.Bread:hover {
	color: teal;
	background:  var(--color_1);
}

.File {
	width:100%;
	cursor:pointer;
	display:block-inline;
}
.File:hover {
	color: teal;
	background:  var(--color_1);
}
.Directory {
	width:100%;
	cursor:pointer;
	display:block-inline;
	color:#AAAAAA;
}
.Directory:hover {
	color: teal;
	background:  var(--color_1);
}
</style>


<!-- ----------------------   Body   ---------------------- -->
<div class="Head">
	<div id="Head_Files" style="width:50%;float:left;text-align:left;"></div>
	<div id="Head_Files_File" style="width:50%;float:right;text-align:right;"></div>
</div>
<div class="Body_Block" style="height:calc(100% - 62px);">
  <div style="width:199px;border-right:1px solid black;float:left;height:100%;overflow:auto;background:var(--color_2);">
	  <div id="File_Manager" style="width:100%;"></div>
  </div>
  <div  id="File_Bowser"style="width:calc(100% - 200px);float:left;height:100%;overflow:auto;-webkit-user-select: text;"></div>
</div>
<div class="Foot">
	<div id="File_Info_Dir" style="width:50%;float:left;text-align:left;"></div>
	<div id="File_Info_File" style="width:50%;float:right;text-align:right;"></div>
</div>




<!-- ----------------------   Script   ---------------------- -->
<script type="text/javascript">
function HtmlToView (data) {
	data = data.replace(new RegExp('<','g'), "&lt");
	data = data.replace(new RegExp('\r?\n','g'), "<br>");
	data = data.replace(new RegExp(" ",'g'), "&nbsp;");
	data = data.replace(new RegExp("\t",'g'), "&nbsp;&nbsp;&nbsp;&nbsp;");
	return data;
}

function DrawBreadroom (pach) {
	var dirs = pach.split(pach_separator);
	var pach = pach_root;
	var html = "<div class='Bread' onclick='OpenDir(\"" + pach + "\")'>" +pach_root + "</div>";
	for (var x=1; dirs[x]; x++) {
		pach += dirs[x] + pach_separator;
		html += "<div class='Bread' onclick='OpenDir(\"" + pach + "\")'>" + dirs[x];
		if (dirs[x + 1]) html += pach_separator;
		html += "</div>";
	}
	document.getElementById("Head_Files").innerHTML = html;
}


function OpenFile (pach,file) {
	Head_Files_File.innerHTML = setts.Hilight_File(file);

	// Open file //
	var data = ReadFileSync (pach + file);

	// Calc file //
	var file_lenght = data.length;
	var str_counter = data.split('\n').length;

	data = HtmlToView(data);

	// View file //
	File_Bowser.innerHTML = Hilight(data);
	//File_Bowser_Textarea.innerHTML = data;

	// View file info //
	if (file_lenght<1024) file_lenght += " Б";
	else if (file_lenght<1024*1024) file_lenght = (file_lenght / 1024).toFixed(2) + " кБ";
	else if (file_lenght<1024*1024*1024) file_lenght = (file_lenght / 1024 / 1024).toFixed(2) + " мБ";
	File_Info_File.innerHTML = "Строк: " + str_counter + " | Размер: " + file_lenght;
}

/*function ViewFileInTerminal (pach,file) {
  MenuOpen('Trminal');
  Input_Exec_Command.value = 'cat ' + pach + file;
  Input_Grep.value = '';
  RunCommand();
}*/



function DrawDir (pach,dir) {
	var html = "<nobr><div class='Directory' onclick=\"OpenDir(\'" + pach + dir + "/\')\">";
	html += "<img src='./images/folder-2.png' height='16'style='margin: 3px 2px -3px 2px;'>" + dir + '</div></nobr>';
	File_Manager.innerHTML += html;
}

function DrawFile (pach,file) {
	var setts = require('./settings.js');

	var html = "<nobr><div class='File' onclick=\"OpenFile(\'" + pach + "\',\'" + file + "\')\">";
	html += "<img src='./images/file-2.png' height='16'style='margin: 3px 6px -3px 6px;'>" + setts.Hilight_File (file) + '</div></nobr>';
	File_Manager.innerHTML += html;
}

var root_pach = __dirname + "/";
var pach = root_pach;
//var pach = '/Users/aleksandrpilipenko/myhome/logs/myhome/';
function OpenDir (pach) {
	File_Manager.innerHTML = "";
	ReadDirToArraySync (pach, function (files) {
		DrawBreadroom (pach);
		var dirs_counter = 0;
		for (var x=0; files[x]; x++) {
			if (!files[x]['isFile']) {
				DrawDir (pach,files[x]['name']);
				dirs_counter++;
			}
		}
		var files_counter = 0;
		for (var x=0; files[x]; x++) {
			if (files[x]['isFile']) {
				DrawFile (pach,files[x]['name']);
				files_counter++;
			}
		}
		//File_Manager.innerHTML += "<hr>" + ToJson(files);
		File_Info_Dir.innerHTML = "Папок: " + dirs_counter + " | Файлов: " + files_counter;
	});
}
OpenDir(pach);
</script>
